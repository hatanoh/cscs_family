## はじめに
__ビルドガイドには有線/pro microの場合の記述がありますが__

__現在有線/Promicro用のファームウェアの提供準備ができていません。__

__有線で使用したいと思っていらっしゃる方はしばらくお待ちください。__

## 作業の流れ
フローチャートを用意しました。
https://github.com/hatanoh/cscs_family/blob/master/Doc/flowchart.png

## 工具確認
以下の工具を用意してください。

|工具/部材		|	|
|---			|---	|
|半田ごて		|必須	|
|ピンセット		|必須	|
|ドライバ		|必須	|
|ニッパ			|必須	|
|ペンチ			|必須	|
|六角レンチ(1.5mm)	|必須	|
|0番＋ドライバ		|必須	|
|フラックス		|必須	|
|半田吸い取り線		|	|
|マスキングテープ|必須|

表面実装部品を半田付けするなら、フラックスは必要です。
また円柱を斜めに切ったようなC型のこてさきや、くさび形のD型のこてさきをつかうとより半田付けがしやすくなるでしょう。
マスキングテープは基板をマークしたり、部品を固定するのに使います。

## 部品を確認する
### キットの内容物を確認する
部品を確認してください。
不足がありましたら作者(Twitter @\_hatano\_)にDMをください。

|部品			|型番		|数量	|
|---			|---		|---	|
|PCB			|		|2	|
|PCB トッププレート	|		|2	|
|PCB ボトムプレート	|		|2	|
|SMDダイオード		|1N4148W	|64(52)	|
|MX用ソケット		|CPG151101S11	|64(52)	|
|choc用ソケット		|CPG135001S30	|64(52)	|
|タクトスイッチ		|TVBP06		|2	|
|TRRSジャック		|MJ4PP9		|2	|
|スライドスイ ッチ	|SK-12D01	|2	|
|単4電池ケース(ピン)	|		|2	|
|DCDCコンバータ		|TPS61221DCK	|2	|
|インダクタ 4.7uH 3030	|LQH3NPZ4R7MMEL	|2	|
|コンデンサ 10uF 0603	|0603 10uF 6.3V	|4	|
|低頭ネジ(M2 3.5mm)	|FX-0235EB	|32	|
|キャップボルト(M2 4mm)	|UC-0204	|18	|
|スペーサー(M2 7mm 丸)	|ARB-02007E	|18	|
|スペーサー(M2 4mm 丸)	|ARB-02004E	|14	|
|ゴム足	       	   	|		|8	|

PCBトッププレートにはドーターボードカバーもくっついています。

### 買い足したパーツを確認する
電源回路はBLE micro Proに単4電池1本で電力を供給するための物です。
無線にしたいのであればBLE micro Pro
有線で良いのであればpromicro を用意しましょう

### 買い足したパーツを確認する(BLE micro Pro使用時/無線1)
コンスルーヘッダも左右分4本必要です。コンスルーヘッダは12pinの物を用意してください。
13pinの物は使えません。

|部品			|数量	|入手先|
|---			|---	|---|
|BLE microPro		|2	|https://booth.pm/ja/items/1177319 あるいは遊舎工房|
|コンスルーヘッダ(12pin)|4	|遊舎工房|
|キースイッチ MX or choc(LP)|64(52)|

### 買い足したパーツを確認する(BLE micro Pro使用時,別売電源回路使用/無線2)
コンスルーヘッダも左右分４本必要です。コンスルーヘッダは12pinの物を用意してください。
13pinの物は使えません。

|部品			|数量	|入手先|
|---			|---	|---|
|BLE microPro		|2	|https://booth.pm/ja/items/1177319 あるいは遊舎工房|
|コンスルーヘッダ(12pin)|4	|遊舎工房|
|昇圧型DCDCコンバータ StepUp/DIP 3.3Vタイプ Ver2(M-05720)|2	|http://akizukidenshi.com/catalog/g/gM-05720/|
|8pin丸ピンソケット|2|http://akizukidenshi.com/catalog/g/gP-00035/|
|M2スペーサ 12mm	|2	|遊舎工房など|

電源回路キットの部品を見て半田付けが難しそうだなと感じたのであれば秋月電子から出来合いの昇圧回路を調達することもできます。
昇圧回路は間違って5Vバージョン(M-03451) を買わないように気をつけて下さい。
また安いからといって、赤い基板の3.3V出力昇圧DCDCコンバータ(K-13066)を買ってもいけません。取り付けられません。
ジャンパを飛ばして無理矢理繋いでも、低電流時の効率が悪いため電池が数日しか持ちません。

丸ピンソケットを使うと、取り付け間違いのリカバリがやりやすいのでお勧めです。

別売り電源回路を使用するとカバーが付属の7mmスペーサーは使用できませんので別途スペーサーを購入して下さい。

### 買い足したパーツを確認する(Promicro使用時/有線)
優先で使用する場合は以下のパーツを購入します。

|部品			|数量	|入手先|
|---			|---	|---|
|pro micro		|2	|遊舎工房その他|
|コンスルーヘッダ(12pin)|4	|遊舎工房|

遊舎工房でpro microを購入した場合はコンスルーヘッダが2本づつ添付されていますので別途購入する必要はありません。

## 基板の準備
二枚の基板を広げてそれぞれ反対側を表にします。
表側に適当にマスキングテープを貼ります。

表裏をテープで示すことにより右手二つあるいは左手二つを作ってしまうことを避けられます。

また、トッププレートPCBからカバーを折り取ります。トッププレートとカバーを繋いでいた基板が残りますので、ペンチで折り取ります。

## 電源回路の組み立て(オプション)
BLE Micro Proを使用する場合はオンボード電源回路、秋月の電源回路のどちらか片方を実装して下さい。
左右2枚とも実装してそれぞれ動作を確認をして下さい。

### オンボード電源回路(オプション)
表側に実装します。
非常に小さい部品を使用していますので紛失に注意してください。
部品をなくした場合は arrow.comやmouser.comなどで入手が可能です。
実装できたら十分に観察して半田付けができていることを確認します。

#### TPS61221
まずTPS61221を実装します。チップ表面に線が引いてある方が1番pinです。
![TPS61221](https://raw.githubusercontent.com/hatanoh/cscs_family/master/Doc/picture/TPS61221.png)
PCBのシルクの線の長い方に1番pinを向けて実装します。

SMDクランプ http://www.proxi.co.jp/products/pamphlet_smd_clamp.htm でチップを抑えながら実装すると楽かもしれません。
わたしは安いピンセットを折り曲げて作ったSMDクランプの「ような物」を使っています。
![のようなもの]

#### チップコンデンサ
1608 チップコンデンサ10uF 2個を実装して下さい。
チップコンデンサには向きはありません。

片方のパッドに予備半田をしてピンセットでつまんだチップコンデンサを半田付け。
冷えてからもう片方を半田を当てて半田付け。とするとうまく半田付けができるでしょう。

#### SMDインダクタ
SMDインダクタを実装して下さい
インダクタにも向きはありません。

### 秋月電源回路
#### ソケット実装(オプション)
シルクで書かれた側のスルーホールに丸ピンソケットを半田付けします。
半田付けした後部品をさします。上が1番ピン側です

#### 直接実装(オプション)
シルクで書かれた側のスルーホールに半田付けします。
上が1番ピン側です

### スイッチ/電池ボックスの取り付け
POWERと書かれた箇所にサイドスライドスイッチを取り付けて下さい。スイッチは表側に付けて、裏側から半田します。
スイッチは一度マスキングテープで固定してから半田付けをすると良いでしょう。

電池ボックスを取り付けます。基板端側が－、内側が＋です。シルクでも指定されています。電池ボックスも表側に部品を載せ、裏側から半田します。
電池ボックスのピンは適切な長さに切断します。長すぎるとボトムプレートに干渉しますし、短すぎると半田付けできません。基板に挿入しすこし飛び出たぐらいのところでニッパーを使って切断します。

### 動作確認
電源スイッチがオフ側になっていることを確認します。電池(アルカリまたはNiMH充電池)を挿入し、電源をオンにします

電源をオンにしたところでBLE micro ProのパターンのBAT-GND間の電圧を測定します。3.3Vを示していれば成功です。
![BAT/GND](https://raw.githubusercontent.com/hatanoh/cscs_family/master/Doc/picture/PowerCheck.png)
写真の赤枠に+、白枠に-を当てて電圧を測ってください。

3.3Vを示していなかった場合には、すぐさまスイッチをオフにして電池を外します。

#### トラブルシュート
まず念のため電池の電圧も測りましょう。1V以下なら交換しましょう。

電源スイッチのON/OFFの方向はシルクに書かれています。電源スイッチをONにして計りましょう。

ICのズレ、接触不良、ショートを確認します、それらが見られた場合には修正しましょう。
電圧を測った時に1.65V程度を示した場合。コンデンサの半田付けができていない場合があります。半田付けし直しましょう。
電圧が0V付近を示していた場合は、インダクタの半田付けに問題がある場合が多いです。半田を付け直しましょう。

電圧がおかしい場合はすぐに電源スイッチをオフにして電池を外しましょう。

秋月回路を使った場合はまず失敗しませんが、電圧が出ていない場合は、基板自体の不良の可能性もありますので購入しているはずのもう一つの回路も試してみましょう。

電池が+/-が逆に接続されてた場合、DCDCコンバータが発熱します。そのままですと壊れてしまうのですぐに電源をオフにして、電池の向きを直してください。

もし内蔵の電源回路を使うこと諦めて秋月回路に変更する場合は、内蔵の回路の部品をきれいに除去し、パターンをきれいにしてください。
ショートしていたりする場合には、正しく動作しません。

電源回路が正しく動作することを確認してから次のステップに進んでください。

## TRRSジャックの取り付け(オプション)
ジャックを半田付けします。表側に部品を付け、裏側から半田してください。

## リセットスイッチの取り付け
タクトスイッチを半田付けします。表側に部品を付け、裏側から半田してください。

## ダイオードの取り付け
ダイオードを裏側に実装します。
一枚の基板の上のダイオードのパターンはすべて同じ向きです。シルクに合わせた向きで実装します。
最初に片方のパッドに予備半田をして片方を半田付けし、その後にもう一方を半田付けすると楽に半田付けができるでしょう。

## ソケットの取り付け
ソケットを取り付けます。基板上側のパターンがMX、下側がchoc(LP)です。
最初に片方のパッドに予備半田をして片方を半田付けし、その後にもう一方を半田付けすると楽に半田付けができるでしょう。
ソケットは両方取り付けてもかまいません。

## トッププレートの作成
### スペーサの取り付け
LPなら4mm。MXなら7mmのスペーサを取り付けます(片手7箇所)

ネジは、低頭ネジかキャップボルトか好きな方を使ってください。

キャップボルトはねじ頭高さが2mmあります。使用するキーキャップによってはぶつかる場合があります。
手元のMDA/DSAのキーキャップ、ロープロでは純正キーキャップではぶつかりませんでしたが、他のキーキャップではぶつかるかもしれません。その場合は低頭ネジを使用してください。

低頭ネジはなめないように気をつけてドライバで、キャップボルトは1.5mmレンチで締め込みます。

### キースイッチの取り付け
4隅にキーを取り付けます。
スイッチはMXとchocを混在して取り付けることはできませんので注意してください。

## 基板にトッププレートを取り付け
基板にトッププレートを取り付けます、ソケットの裏側からキーがただしく刺さっていることを確認します。正しく刺さっていればほんの少しソケットの裏から端子が見えるはずです。

## 残りのキースイッチの取り付け
向きを合わせてソケットを実装します。
これも正しく刺さっていることを確認します、

## promicro あるいは BLE micro proの取り付け
BLE micro proの場合には、USBコネクタを上側にして左側は上側にコンスルーヘッダをつけてください。
BLE micro proは部品面を下にして取り付けます。コンスルーヘッダは半田付けはしないで下さい。

コンスルーヘッダの向きは写真を参考にしてください。

promicroの場合には、USBコネクタを上側にして左側は下側にコンスルーヘッダをつけてください。
promicroは部品面を下にして取り付けます。コンスルーヘッダはProMicroに半田付けして下さい。基板側は半田付けしないでください。

# ファームウェアの書き込み(無線)
```
% git clone -b nrf52 https://github.com/hatanoh/qmk_firmware.git 
```
でソースを取得し
```
% make cscs64_ble/master:cscs64:nrfutil		# 左側 cscs64の場合
% make cscs64_ble/slave:cscs64:nrfutil		# 右側 cscs64の場合
```
```
% make cscs64_ble/master:cscs52:nrfutil		# 左側 cscs52の場合
% make cscs64_ble/slave:cscs52:nrfutil		# 右側 cscs52の場合
```
でファームウェアの書き込みを行ってください

BLE micro PRO向け環境構築やビルドの手順は
https://github.com/sekigon-gonnoc/BLE-Micro-Pro#%E3%83%93%E3%83%AB%E3%83%89%E7%92%B0%E5%A2%83
を参照してください。

# ファームウェアの書き込み(有線)
TBD

現在有線ファームウェアの公開の準備ができていません。
バイナリのみ準備しています。qmk_toolboxで書き込みを行ってください。左右は同じバイナリです。
キーマップは無線のものと同じです。

現状のソースは個別対応で提供します。

## 動作確認
すべてのキーが入力を受け付けることを確認してください。

## カバーの取り付け
裏側から低頭ネジを入れ、表側に7mmスペーサーを取りつけて下さい。低頭ネジはなめないように気をつけてしめて下さい。

表側にカバーをのせ、キャップボルトを締めて固定してください。多少がたつきますので、本体基板と平行になるように固定して下さい。

秋月の電源回路を使用した場合には適切な長さのスペーサー（別売り）を使ってください。

## ボトムプレートの取り付け
裏側から、低頭ネジで７箇所を固定してください。くれぐれもねじ頭をなめないように気をつけてください。

## ゴム足の取り付け
裏側４箇所にゴム足を貼ってください。
